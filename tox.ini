[tox]
envlist = py{36,37}

[testenv]
skipsdist = true
usedevelop = true
passenv = LD_LIBRARY_PATH
setenv =
       LD_LIBRARY_PATH = {homedir}/.local/lib:$LD_LIBRARY_PATH
deps =
     cmake
     {[testenv:flake8]deps}
     {[testenv:doctests]deps}
commands =
	 python run-tests.py --quick

[testenv:withscikitsodes]
whitelist_externals = echo
setenv =
       {[testenv]setenv}
       SUNDIALS_INST = {homedir}/.local
deps =
     {[testenv]deps}
     scikits.odes

[testenv:unit]
commands = python run-tests.py --unit --folder all

[testenv:unit-withscikitsodes]
setenv = {[testenv:scikitsodes]setenv}
deps = {[testenv:scikitsodes]deps}
commands = python run-tests.py --unit --folder all

[testenv:sundials]
skip_install = true
passenv = HOME
whitelist_externals = git
deps =
     wget
     cmake
commands =
         python {toxinidir}/scripts/install_KLU_Sundials.py
	 - git clone https://github.com/pybind/pybind11.git {toxinidir}/pybind11

[testenv:dev]
usedevelop=true
deps =
     cmake
     flake8>=3
     black
whitelist_externals = echo
commands =
	 echo "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH" >> {envbindir}/activate

[testenv:dev-scikitsodes]
usedevelop = true
deps =
     {[testenv:dev]deps}
     scikits.odes
whitelist_externals = {[testenv:dev]whitelist_externals}
commands = {[testenv:dev]commands}



[testenv:flake8]
skip_install = true
deps = flake8>=3
commands = python -m flake8

[testenv:coverage]
deps = coverage
commands = python -m coverage run run-tests.py --nosub

[testenv:doctests]
deps =
     sphinx>=1.5
     guzzle-sphinx-theme
commands = python run-tests.py --doctest

[testenv:examples]
skip_install = false
deps =
commands = python run-tests.py --examples

[testenv:docs]
skipdist = true
skip_install = false
deps =
     {[testenv:doctests]deps}
     sphinx-autobuild
changedir = docs
commands = python -m sphinx-autobuild -BqT . {envtmpdir}/html

[flake8]
max-line-length = 88
exclude=
    .git,
    problems,
    __init__.py,
    venv,
    bin,
    etc,
    lib,
    lib64,
    share,
    pyvenv.cfg,
    third-party,
    sundials-5.0.0,
    KLU_module_deps,
    pybind11,
ignore=
    # False positive for white space before ':' on list slice
    # black should format these correctly
    E203,

    # Block comment should start with '# '
    # Not if it's a commented out line
    E265,

    # Ambiguous variable names
    # It's absolutely fine to have i and I
    E741,

    # List comprehension redefines variable
    # Re-using throw-away variables like `i`, `x`, etc. is a Good Idea
    F812,

    # Blank line at end of file
    # This increases readability
    W391,

    # Line break before binary operator
    # This is now actually advised in pep8
    W503,

    # Line break after binary operator
    W504,

    # Invalid escape sequence
    # These happen all the time in latex parts of docstrings,
    # e.g. \sigma
    W605,

[coverage:run]
source = pybamm